{
	"name": "pl_d365crmextract",
	"properties": {
		"activities": [
			{
				"name": "D365CRM_GetToken",
				"type": "WebActivity",
				"dependsOn": [],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"url": {
						"value": "https://login.microsoftonline.com/9f5fb3c2-436f-448a-87ce-a0931ec94aba/oauth2/token",
						"type": "Expression"
					},
					"method": "POST",
					"headers": {
						"Content-Type": {
							"value": "application/x-www-form-urlencoded",
							"type": "Expression"
						}
					},
					"body": {
						"value": "grant_type=client_credentials&tenant_id=9f5fb3c2-436f-448a-87ce-a0931ec94aba&client_id=18ae9f8d-c9c2-4baf-8157-b82410f34429&client_secret=63c8Q~Su82pzTyTOR6mhFh1Q2d3r_FaQPhXGcaxe&resource=https://newforestsdev.crm6.dynamics.com/",
						"type": "Expression"
					}
				}
			},
			{
				"name": "D365APItoTable_Asset",
				"type": "Copy",
				"dependsOn": [
					{
						"activity": "D365CRM_GetToken",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "RestSource",
						"httpRequestTimeout": "00:01:40",
						"requestInterval": "00.00:00:00.010",
						"requestMethod": "GET",
						"additionalHeaders": {
							"Authorization": {
								"value": "@{concat(' Bearer ', activity('D365CRM_GetToken').output.access_token)}",
								"type": "Expression"
							}
						},
						"paginationRules": {
							"supportRFC5988": "true"
						}
					},
					"sink": {
						"type": "AzureSqlSink",
						"writeBehavior": "insert",
						"sqlWriterUseTableLock": false,
						"tableOption": "autoCreate",
						"disableMetricsCollection": false
					},
					"enableStaging": false,
					"translator": {
						"type": "TabularTranslator",
						"mappings": [
							{
								"source": {
									"path": "$['value'][0]['mcs_assetuniqueid']"
								},
								"sink": {
									"name": "Asset"
								}
							},
							{
								"source": {
									"path": "$['value'][0]['statecode']"
								},
								"sink": {
									"name": "Status"
								}
							},
							{
								"source": {
									"path": "$['value'][0]['statuscode']"
								},
								"sink": {
									"name": "Status_Reason"
								}
							},
							{
								"source": {
									"path": "$['value'][0]['mcs_name']"
								},
								"sink": {
									"name": "Name"
								}
							},
							{
								"source": {
									"path": "$['value'][0]['mcs_assetid']"
								},
								"sink": {
									"name": "Asset_ID"
								}
							}
						],
						"collectionReference": ""
					}
				},
				"inputs": [
					{
						"referenceName": "API_D365CRM_Asset",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "ds_SQLDynamicTable",
						"type": "DatasetReference",
						"parameters": {
							"TableName": {
								"value": "D365CRM_Asset",
								"type": "Expression"
							},
							"SchemaName": {
								"value": "raw",
								"type": "Expression"
							}
						}
					}
				]
			},
			{
				"name": "D365APItoTable_FUM",
				"type": "Copy",
				"dependsOn": [
					{
						"activity": "D365CRM_GetToken",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "RestSource",
						"httpRequestTimeout": "00:01:40",
						"requestInterval": "00.00:00:00.010",
						"requestMethod": "GET",
						"additionalHeaders": {
							"Authorization": {
								"value": "@{concat(' Bearer ', activity('D365CRM_GetToken').output.access_token)}",
								"type": "Expression"
							}
						},
						"paginationRules": {
							"supportRFC5988": "true"
						}
					},
					"sink": {
						"type": "AzureSqlSink",
						"writeBehavior": "insert",
						"sqlWriterUseTableLock": false,
						"tableOption": "autoCreate",
						"disableMetricsCollection": false
					},
					"enableStaging": false,
					"translator": {
						"type": "TabularTranslator",
						"mappings": [
							{
								"source": {
									"path": "$['value'][0]['mcs_note']"
								},
								"sink": {
									"name": "Note",
									"type": "String"
								}
							},
							{
								"source": {
									"path": "$['value'][0]['mcs_fumid']"
								},
								"sink": {
									"name": "FUM",
									"type": "String"
								}
							},
							{
								"source": {
									"path": "$['value'][0]['_mcs_asset_value']"
								},
								"sink": {
									"name": "Asset",
									"type": "String"
								}
							},
							{
								"source": {
									"path": "$['value'][0]['mcs_periodclose']"
								},
								"sink": {
									"name": "Period_Close",
									"type": "Boolean"
								}
							},
							{
								"source": {
									"path": "$['value'][0]['statuscode']"
								},
								"sink": {
									"name": "Status_Reason",
									"type": "String"
								}
							},
							{
								"source": {
									"path": "$['value'][0]['mcs_date']"
								},
								"sink": {
									"name": "Date",
									"type": "DateTime"
								}
							},
							{
								"source": {
									"path": "$['value'][0]['_mcs_consultant_value']"
								},
								"sink": {
									"name": "Consultant",
									"type": "String"
								}
							},
							{
								"source": {
									"path": "$['value'][0]['statecode']"
								},
								"sink": {
									"name": "Status",
									"type": "String"
								}
							},
							{
								"source": {
									"path": "$['$[\\'value\\'][0][\\'mcs_type\\']']"
								},
								"sink": {
									"name": "Type",
									"type": "String"
								}
							}
						],
						"collectionReference": ""
					}
				},
				"inputs": [
					{
						"referenceName": "API_D365CRM_FUM",
						"type": "DatasetReference",
						"parameters": {
							"basesourcename": "mcs_fums"
						}
					}
				],
				"outputs": [
					{
						"referenceName": "ds_SQLDynamicTable",
						"type": "DatasetReference",
						"parameters": {
							"TableName": {
								"value": "D365CRM_FUM",
								"type": "Expression"
							},
							"SchemaName": {
								"value": "raw",
								"type": "Expression"
							}
						}
					}
				]
			}
		],
		"variables": {
			"test": {
				"type": "String"
			}
		},
		"annotations": []
	}
}